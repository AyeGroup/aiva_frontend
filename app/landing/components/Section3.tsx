"use client";
import svgPaths from "../svg/svg-2dmtneq5en";
import { color, motion } from "motion/react";
import { cubicBezier } from "motion/react";
import { useState, useEffect } from "react";

function Icon() {
  return (
    <div
      className="absolute left-[1063.7px] size-16 top-[226.71px]"
      data-name="Icon"
    >
      <svg
        className="block size-full"
        fill="none"
        preserveAspectRatio="none"
        viewBox="0 0 64 64"
      >
        <g id="Icon" opacity="0.25">
          <path
            d={svgPaths.paab5900}
            id="Vector"
            stroke="var(--stroke-0, #52D4A0)"
            strokeWidth="5.33333"
          />
          <path
            d={svgPaths.p23cebf00}
            id="Vector_2"
            stroke="var(--stroke-0, #52D4A0)"
            strokeWidth="5.33333"
          />
        </g>
      </svg>
    </div>
  );
}

function Icon1() {
  return (
    <div
      className="absolute left-[100.23px] size-14 top-[737.52px]"
      data-name="Icon"
    >
      <svg
        className="block size-full"
        fill="none"
        preserveAspectRatio="none"
        viewBox="0 0 56 56"
      >
        <g id="Icon" opacity="0.25">
          <path
            d={svgPaths.p7152400}
            fill="var(--fill-0, #FFA18E)"
            id="Vector"
            opacity="0.524085"
          />
        </g>
      </svg>
    </div>
  );
}

function Icon2() {
  return (
    <div
      className="absolute left-[187.94px] size-12 top-[510.11px]"
      data-name="Icon"
    >
      <svg
        className="block size-full"
        fill="none"
        preserveAspectRatio="none"
        viewBox="0 0 48 48"
      >
        <g id="Icon" opacity="0.3">
          <path
            d="M10 24H38"
            id="Vector"
            stroke="var(--stroke-0, #4460F7)"
            strokeWidth="4"
          />
          <path
            d="M24 10L38 24L24 38"
            id="Vector_2"
            stroke="var(--stroke-0, #4460F7)"
            strokeWidth="4"
          />
        </g>
      </svg>
    </div>
  );
}

function Icon3() {
  return (
    <div
      className="absolute left-[1062.64px] size-10 top-[866.88px]"
      data-name="Icon"
    >
      <svg
        className="block size-full"
        fill="none"
        preserveAspectRatio="none"
        viewBox="0 0 40 40"
      >
        <g id="Icon" opacity="0.3">
          <path
            d={svgPaths.p19a01780}
            id="Vector"
            stroke="var(--stroke-0, #65BCB6)"
            strokeWidth="3.33333"
          />
          <path
            d={svgPaths.p24376300}
            id="Vector_2"
            stroke="var(--stroke-0, #65BCB6)"
            strokeWidth="3.33333"
          />
        </g>
      </svg>
    </div>
  );
}

function Icon4() {
  return (
    <div className="relative shrink-0 size-7" data-name="Icon">
      <svg
        className="block size-full"
        fill="none"
        preserveAspectRatio="none"
        viewBox="0 0 28 28"
      >
        <g id="Icon">
          <path
            d={svgPaths.p1668d400}
            id="Vector"
            stroke="var(--stroke-0, #B07CC6)"
            strokeLinecap="round"
            strokeLinejoin="round"
            strokeWidth="2.33333"
          />
          <path
            d={svgPaths.p18e93240}
            id="Vector_2"
            stroke="var(--stroke-0, #B07CC6)"
            strokeLinecap="round"
            strokeLinejoin="round"
            strokeWidth="2.33333"
          />
          <path
            d={svgPaths.p1987b500}
            id="Vector_3"
            stroke="var(--stroke-0, #B07CC6)"
            strokeLinecap="round"
            strokeLinejoin="round"
            strokeWidth="2.33333"
          />
          <path
            d={svgPaths.p86b7780}
            id="Vector_4"
            stroke="var(--stroke-0, #B07CC6)"
            strokeLinecap="round"
            strokeLinejoin="round"
            strokeWidth="2.33333"
          />
        </g>
      </svg>
    </div>
  );
}

function Icon5() {
  return (
    <div className="relative shrink-0 size-[29.4px]" data-name="Icon">
      <svg
        className="block size-full"
        fill="none"
        preserveAspectRatio="none"
        viewBox="0 0 30 30"
      >
        <g id="Icon">
          <path
            d={svgPaths.p18226e00}
            id="Vector"
            stroke="currentColor"
            strokeLinecap="round"
            strokeLinejoin="round"
            strokeWidth="2.45"
          />
          <path
            d={svgPaths.p3b126880}
            id="Vector_2"
            stroke="currentColor"
            strokeLinecap="round"
            strokeLinejoin="round"
            strokeWidth="2.45"
          />
        </g>
      </svg>
    </div>
  );
}

function Icon6() {
  return (
    <div className="relative shrink-0 size-7" data-name="Icon">
      <svg
        className="block size-full"
        fill="none"
        preserveAspectRatio="none"
        viewBox="0 0 28 28"
      >
        <g id="Icon">
          <path
            d="M14 3.5V17.5"
            id="Vector"
            stroke="var(--stroke-0, #52D4A0)"
            strokeLinecap="round"
            strokeLinejoin="round"
            strokeWidth="2.33333"
          />
          <path
            d={svgPaths.p1264cb00}
            id="Vector_2"
            stroke="var(--stroke-0, #52D4A0)"
            strokeLinecap="round"
            strokeLinejoin="round"
            strokeWidth="2.33333"
          />
          <path
            d={svgPaths.p1e686c20}
            id="Vector_3"
            stroke="var(--stroke-0, #52D4A0)"
            strokeLinecap="round"
            strokeLinejoin="round"
            strokeWidth="2.33333"
          />
        </g>
      </svg>
    </div>
  );
}

function Icon7() {
  return (
    <div className="relative shrink-0 size-[14px]" data-name="Icon">
      <svg
        className="block size-full"
        fill="none"
        preserveAspectRatio="none"
        viewBox="0 0 14 14"
      >
        <g id="Icon">
          <path
            d={svgPaths.p3de7e600}
            id="Vector"
            stroke="var(--stroke-0, white)"
            strokeLinecap="round"
            strokeLinejoin="round"
            strokeWidth="1.75"
          />
        </g>
      </svg>
    </div>
  );
}

function Icon8() {
  return (
    <div className="relative shrink-0 size-7" data-name="Icon">
      <svg
        className="block size-full"
        fill="none"
        preserveAspectRatio="none"
        viewBox="0 0 28 28"
      >
        <g id="Icon">
          <path
            d={svgPaths.p184ba090}
            id="Vector"
            stroke="var(--stroke-0, #65BCB6)"
            strokeLinecap="round"
            strokeLinejoin="round"
            strokeWidth="2.33333"
          />
          <path
            d={svgPaths.p5d36b00}
            id="Vector_2"
            stroke="var(--stroke-0, #65BCB6)"
            strokeLinecap="round"
            strokeLinejoin="round"
            strokeWidth="2.33333"
          />
          <path
            d="M22.1667 9.33333V16.3333"
            id="Vector_3"
            stroke="var(--stroke-0, #65BCB6)"
            strokeLinecap="round"
            strokeLinejoin="round"
            strokeWidth="2.33333"
          />
          <path
            d="M25.6667 12.8333H18.6667"
            id="Vector_4"
            stroke="var(--stroke-0, #65BCB6)"
            strokeLinecap="round"
            strokeLinejoin="round"
            strokeWidth="2.33333"
          />
        </g>
      </svg>
    </div>
  );
}

function Icon9() {
  return (
    <div className="relative shrink-0 size-[14px]" data-name="Icon">
      <svg
        className="block size-full"
        fill="none"
        preserveAspectRatio="none"
        viewBox="0 0 14 14"
      >
        <g id="Icon">
          <path
            d={svgPaths.p3de7e600}
            id="Vector"
            stroke="var(--stroke-0, white)"
            strokeLinecap="round"
            strokeLinejoin="round"
            strokeWidth="1.75"
          />
        </g>
      </svg>
    </div>
  );
}

///////////////////////////////////////////////////////////////////////////////
function CardContainer() {
  return (
    <div
      className="h-[978px] overflow-clip relative shrink-0 w-full"
      data-name="Container"
    >
      <Icon />
      <Icon1 />
      <Icon2 />
      <Icon3 />
    </div>
  );
}

function Heading1() {
  return (
    <div
      className="bg-[rgba(101,188,182,0.08)] h-[46px] relative rounded-[100px] shrink-0 w-[130.617px]"
      data-name="Container"
    >
      <div
        aria-hidden="true"
        className="absolute border border-[rgba(101,188,182,0.15)] border-solid inset-0 pointer-events-none rounded-[100px]"
      />
      <div
        className="absolute bg-[#65bcb6] left-[101.62px] rounded-sm size-2 top-5"
        data-name="Text"
      />
      <div
        className="absolute h-6 left-[21px] top-[11px] w-[72.617px]"
        data-name="Text"
      >
        <p
          className="absolute  font-semibold leading-6 left-9 text-[#65bcb6] text-center text-nowrap top-[-0.5px] tracking-[-0.16px] translate-x-[-50%] whitespace-pre"
          dir="auto"
        >
          فرآیند ساده
        </p>
      </div>
    </div>
  );
}

function Heading2() {
  return (
    <div
      className="h-[57.594px] relative shrink-0 w-full"
      data-name="Heading 2"
    >
      <p
        className="absolute 
       font-extrabold leading-[57.6px] left-[616.04px] text-center text-gray-900 -top-px tracking-[-0.96px] translate-x-[-50%] w-[709px]"
        dir="auto"
      >
        آیوا را در ۴ مرحله ساده راه‌اندازی کنید
      </p>
    </div>
  );
}

function Heading3() {
  return (
    <div
      className="content-stretch flex h-[28.797px] items-start relative shrink-0 w-[600px]"
      data-name="Paragraph"
    >
      <p
        className="basis-0  font-normal grow leading-[28.8px] min-h-px min-w-px relative shrink-0 text-center text-gray-600"
        dir="auto"
      >
        از ثبت‌نام تا اولین گفت‌وگو، تنها چند دقیقه فاصله دارید
      </p>
    </div>
  );
}

function Header() {
  return (
    <motion.div
      initial={{ opacity: 0, y: 30 }}
      whileInView={{ opacity: 1, y: 0 }}
      viewport={{ once: true, amount: 0.8 }}
      transition={{ duration: 0.6, ease: "easeOut" }}
      className="content-stretch flex flex-col gap-6 items-center justify-center relative shrink-0 w-[1232px]"
      data-name="Header"
    >
      <Heading1 />
      <Heading2 />
      <Heading3 />
    </motion.div>
  );
}

function SliderDot({ isActive }: { isActive: boolean }) {
  return (
    <motion.div
      className="h-[3px] rounded-bl-6 rounded-br-6 shrink-0 w-full transition-colors duration-500"
      style={{
        backgroundColor: isActive ? "#B07CC6" : "#e5e7eb",
      }}
      data-name="Container"
    />
  );
}

const cardVariants = {
  hidden: {
    opacity: 0,
    y: 50,
    scale: 0.9,
  },
  visible: {
    opacity: 1,
    y: 0,
    scale: 1,
    transition: {
      duration: 0.6,
      ease: cubicBezier(0.25, 0.1, 0.25, 1), // ✅ درست و معادل ease قبلی
    },
  },
};

interface ArticleProps {
  isActive: boolean;
  icon: React.ReactNode;
  color: string;
  step: number;
  title: string;
  description: string;
  duration: string;
}

function Article({
  isActive,
  icon,
  color,
  step,
  title,
  description,
  duration,
}: ArticleProps) {
  const containerBg = isActive ? "bg-white" : "bg-neutral-50";
  const borderWidth = isActive ? 2 : 1;
  const borderColor = isActive ? color : "#E5E7EB";
  const shadow = isActive
    ? `0px 24px 48px rgba(0,0,0,0.12), 0px 0px 0px 2px ${color}`
    : "none";

  return (
    <div
      className={`basis-0 grow min-h-px min-w-px relative rounded-2xl shrink-0 transition-all duration-500 ${containerBg}`}
      data-name="Article"
      style={{
        borderWidth: borderWidth,
        borderColor: borderColor,
        borderStyle: "solid",
        boxShadow: shadow,
      }}
    >
      <div className="flex flex-col items-center overflow-clip rounded-2xl w-full">
        <div className="flex flex-col items-center gap-7 pb-px pt-8 px-4 w-full relative">
          {/* Icon */}

          <div className="h-16 relative shrink-0 w-60">
            <div
              className="absolute flex items-center justify-center left-[88px] rounded-xl size-16 top-0"
              style={{ backgroundColor: "rgba(101,188,182,0.1)", color }}
            >
              {icon}
            </div>

            <div
              className={`w-6 h-6 rounded-full text-sm shadow-[0px_4px_12px_0px_rgba(0,0,0,0.2)]  p-1 font-semibold text-white flex justify-center items-center`}
              style={{ backgroundColor: color }}
            >
              {step + 1}
            </div>
          </div>

          {/* Content */}
          <div className="h-[141.188px] relative shrink-0 w-60">
            <h3 className="absolute h-6 left-1/2 top-0 -translate-x-1/2 text-center text-gray-900 font-normal leading-6">
              {title}
            </h3>
            <p className="absolute h-[51.188px] left-1/2 top-8 -translate-x-1/2 text-center text-gray-500 font-normal leading-[25.6px] w-[228px]">
              {description}
            </p>

            {/* Duration */}
            <div
              className="absolute bg-gray-100 h-[42px] left-[70.77px] rounded-full top-[99.19px] flex items-center justify-center"
              style={{ color }}
            >
              <div className="flex items-center py-2 px-4 rounded-full bg-gray-100">
                <div
                  className={`w-2 h-2 rounded-full ml-2`}
                  style={{ backgroundColor: color }}
                ></div>
                {duration}
              </div>
              {/* <div */}
              {/* aria-hidden="true" */}
              {/* className="absolute inset-0 pointer-events-none border border-gray-200 rounded-full" */}
              {/* /> */}
              {/* <div className="absolute bg-gray-400 left-[75.45px] rounded-[3px] size-1.5 top-[18px]" /> */}
              {/* <div className="absolute h-6 left-[17px] top-[9px] w-[50.453px]  bg-gray-300"> */}
              {/* <p className="absolute font-bold leading-6 left-1/2 -translate-x-1/2 text-center w-[51px]"> */}
              {/* </p> */}
              {/* </div> */}
            </div>
          </div>

          <motion.div
            className="h-[3px] rounded-bl-6 rounded-br-6 shrink-0 w-full transition-colors duration-500"
            style={{
              backgroundColor: isActive ? color : "#e5e7eb",
            }}
            data-name="Container"
          />

          {/* <SliderDot isActive={isActive} /> */}
        </div>
      </div>
    </div>
  );
}

const articlesData = [
  {
    step: 0,
    color: "#65BCB6",
    icon: <Icon8 />,
    title: "ثبت‌نام",
    description: "حساب کاربری خود را در کمتر از ۳۰ ثانیه ایجاد کنید",
    duration: "۳۰ ثانیه",
  },
  {
    step: 1,
    color: "#52D4A0",
    icon: <Icon6 />,
    title: "آموزش",
    description: "منابع و اطلاعات کسب‌وکار خود را آپلود کنید",
    duration: "2 دقیقه",
  },
  {
    step: 2,
    color: "#ffa18e",
    icon: <Icon5 />,
    title: "شخصی‌سازی",
    description: "ظاهر و رفتار چت‌بات را مطابق برند خود تنظیم کنید",
    duration: "5 دقیقه",
  },
  {
    step: 3,
    color: "#B07CC6",
    icon: <Icon4 />,
    title: "راه‌اندازی",
    description: "چت‌بات را روی وب‌سایت یا اپلیکیشن خود نصب کنید",
    duration: "۲ دقیقه",
  },
];

function Card({ activeStep }: { activeStep: number }) {
  return (
    <motion.div
      initial="hidden"
      whileInView="visible"
      viewport={{ once: true, amount: 0.3 }}
      variants={{
        hidden: {},
        visible: {
          transition: {
            staggerChildren: 0.15,
            delayChildren: 0.1,
          },
        },
      }}
      className="flex gap-6 items-center justify-center w-full relative shrink-0"
    >
      {articlesData.map(({ step, ...props }) => (
        <motion.div key={step} variants={cardVariants}>
          <Article isActive={activeStep === step} step={step} {...props} />
        </motion.div>
      ))}
    </motion.div>
  );
}

// Timeline
function Container27() {
  return (
    <div
      className="absolute bg-gray-200 h-0.5 right-0 rounded-[1px] top-0 w-[900px]"
      data-name="Container"
    />
  );
}

function Container28({ activeStep }: { activeStep: number }) {
  const progressColors = ["#65BCB6", "#52D4A0", "#ffa18e", "#B07CC6"];
  const progressWidths = [225, 450, 675, 900];

  return (
    <motion.div
      className="absolute h-0.5 right-0 rounded-[1px] top-0"
      style={{
        backgroundColor: progressColors[activeStep],
        boxShadow: `0px 0px 12px 0px ${progressColors[activeStep]}66`,
      }}
      animate={{
        width: progressWidths[activeStep],
      }}
      transition={{
        duration: 0.5,
        ease: "easeInOut",
      }}
      data-name="Container"
    />
  );
}

function Container29({ activeStep }: { activeStep: number }) {
  return (
    <div className="h-0.5 relative shrink-0 w-[900px]" data-name="Container">
      <Container27 />
      <Container28 activeStep={activeStep} />
    </div>
  );
}

function TabList({ activeStep }: { activeStep: number }) {
  // ترتیب رنگ‌ها از راست به چپ: ثبت‌نام، آموزش، شخصی‌سازی، راه‌اندازی
  const tabColors = ["#65BCB6", "#52D4A0", "#ffa18e", "#B07CC6"];

  return (
    <div
      className="content-stretch flex gap-3 h-3 items-center justify-center relative shrink-0 w-[1232px]"
      data-name="Tab List"
    >
      {[0, 1, 2, 3].map((index) => (
        <div
          key={index}
          className={`relative rounded-[6px] shrink-0 transition-all duration-500 ${
            activeStep === index
              ? "w-8 h-3 shadow-[0px_2px_8px_0px_rgba(0,0,0,0.15)]"
              : "size-3 bg-gray-200"
          }`}
          style={{
            backgroundColor:
              activeStep === index ? tabColors[index] : undefined,
          }}
          data-name="Tab"
        >
          <div className="bg-clip-padding border-0 border-transparent border-solid box-border size-full" />
        </div>
      ))}
    </div>
  );
}

function Liner({ activeStep }: { activeStep: number }) {
  return (
    <motion.div
      initial={{ opacity: 0, y: 20 }}
      whileInView={{ opacity: 1, y: 0 }}
      viewport={{ once: true, amount: 0.8 }}
      transition={{ duration: 0.6, ease: "easeOut", delay: 0.3 }}
      className="content-stretch flex flex-col gap-6 items-center justify-center relative shrink-0 w-full"
      data-name="liner"
    >
      <Container29 activeStep={activeStep} />
      <TabList activeStep={activeStep} />
    </motion.div>
  );
}

function CTA() {
  return (
    <div className="content-stretch flex gap-3 h-[46px] items-center ">
      <span> کل فرآیند کمتر از</span>
      <span className=" text-[#65bcb6] font-bold"> ۱۰ دقیقه</span>
      <span> زمان می‌برد</span>
    </div>
  );
}

function Button() {
  return (
    <div
      className="bg-[#65bcb6]  rounded-2xl text-white px-8 py-4"
      data-name="Button"
    >
      شروع رایگان
    </div>
  );
}

function ContainerFooter() {
  return (
    <motion.div
      initial={{ opacity: 0, y: 20 }}
      whileInView={{ opacity: 1, y: 0 }}
      viewport={{ once: true, amount: 0.8 }}
      transition={{ duration: 0.6, ease: "easeOut", delay: 0.4 }}
      className="relative shrink-0 w-full"
      data-name="Container"
    >
      <div className="flex flex-col items-center justify-center size-full">
        <div className="box-border content-stretch flex flex-col gap-8 items-center justify-center px-[470px] py-0 relative w-full">
          <CTA />
          <Button />
        </div>
      </div>
    </motion.div>
  );
}

export default function Section3() {
  const [activeStep, setActiveStep] = useState(0);

  useEffect(() => {
    const interval = setInterval(() => {
      setActiveStep((prev) => (prev + 1) % 4);
    }, 3000); // تغییر هر 3 ثانیه

    return () => clearInterval(interval);
  }, []);

  return (
    <motion.div
      initial={{ opacity: 0, y: 30 }}
      whileInView={{ opacity: 1, y: 0 }}
      viewport={{ once: true, margin: "-100px" }}
      transition={{ duration: 0.6, ease: "easeOut" }}
      className="content-stretch flex flex-col gap-2 items-start relative w-full"
    >
      <CardContainer />
      <div
        className="absolute bg-linear-to-b from-[#ffffff] h-[956px] left-0 overflow-clip to-[#ffffff] top-[-0.37px] via-50% via-[#f9fafb] w-[1431px]"
        data-name="Process"
      >
        <div
          className="absolute box-border content-stretch flex flex-col gap-[58px] items-center justify-center left-0 p-16 top-[-0.37px] w-[1419px]"
          data-name="Container"
        >
          <Header />
          <Card activeStep={activeStep} />
          <Liner activeStep={activeStep} />
          <ContainerFooter />
        </div>
      </div>
    </motion.div>
  );
}
